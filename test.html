<html>
<head>
<script src="jquery-2.1.1.min.js"></script>
<script>
// Courtesy: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toISOString
if ( !Date.prototype.toISOString ) {
  ( function() {
    function pad(number) {
      var r = String(number);
      if ( r.length === 1 ) {
        r = '0' + r;
      }
      return r;
    }
    Date.prototype.toISOString = function() {
      return this.getUTCFullYear()
        + '-' + pad( this.getUTCMonth() + 1 )
        + '-' + pad( this.getUTCDate() )
        + 'T' + pad( this.getUTCHours() )
        + ':' + pad( this.getUTCMinutes() )
        + ':' + pad( this.getUTCSeconds() )
        + '.' + String( (this.getUTCMilliseconds()/1000).toFixed(3) ).slice( 2, 5 )
        + 'Z';
    };
  }() );
}

var badCredentials=false;
var setOTP=false;
var token="";

function getAuthorization() {
    if (token=="") {
        return "Basic " + btoa($("#username").val() + ":" + $("#password").val())
    } else {
        return "token " + token;
    }
}

function login(event) {
    var date = new Date();
    var theData = '{"scopes":["repo","public_repo","user","write:public_key","user:email"],"note":"starterupper ' + date.toISOString() + '"}';
    
    $.ajax({
        url: "https://api.github.com/authorizations",
        type: "POST",
        beforeSend: function(xhr) {
            xhr.setRequestHeader("Authorization", getAuthorization());
            xhr.setRequestHeader("Content-Type", "application/json");
            if (setOTP) {
                xhr.setRequestHeader("X-Github-OTP", $("#otp").val());
            }
        },
        dataType: "json",
        data: theData,
        success: function( response ) {
            token = response.token;
            for (key in response) { 
                $( "#user" ).append( "<li>" + key + ": " + response[key] + "</li>" );
            }
        },
        error: function( response ) {
            if (response.status == 401) {
                if (response.responseJSON.message == "Bad credentials") {
                    badCredentials=true;
                } else if (response.responseJSON.message == "Must specify two-factor authentication OTP code.") {
                    setOTP=true;
                }
            }
            $("#user").append("<li>" + response.responseJSON.message + "</li>" );
            for (key in response) { 
                $( "#user" ).append( "<li>" + key + ": " + response[key] + "</li>" );
            }
        }
    });
}
</script>
</head>
<body>
<form>
<input type="text" name="username" id="username" placeholder="Github username" /><br />
<input type="password" name="password" id="password" placeholder="Password" /><br/>
<input type="text" name="otp" id="otp" placeholder="Two-factor code" /><br/>
<input type="button" onclick="login(this);" value="Login" />
</form>

<ul id="user"></ul>
</body>
</html>